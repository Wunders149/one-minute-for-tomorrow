<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Visibility Choice - One Minute for Tomorrow</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600&display=swap" rel="stylesheet"/>
    <link href="../../src/css/styles.css" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ecb613",
                        "background-light": "#f8f8f6",
                        "background-dark": "#221d10",
                        "surface-dark": "#2c2616",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                },
            },
        }
    </script>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display antialiased overflow-hidden">
<div class="relative flex h-screen w-full flex-col justify-between overflow-hidden">
    <!-- Atmospheric Background -->
    <div class="absolute inset-0 z-0 overflow-hidden pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-primary/10 rounded-full blur-[120px] animate-pulse-slow"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[600px] h-[600px] bg-primary/5 rounded-full blur-[100px]"></div>
    </div>
    
    <!-- Top Bar -->
    <div class="z-10 w-full h-12 flex items-center justify-between px-6">
        <a href="/src/pages/index.html" class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-primary/10 transition-all duration-300">
            <span class="material-symbols-outlined text-neutral-900 dark:text-white hover:text-primary">arrow_back</span>
        </a>
    </div>
    
    <!-- Main Content -->
    <div class="z-10 flex flex-1 flex-col items-center justify-center px-8 w-full max-w-md mx-auto">
        <div class="mb-8 opacity-80">
            <span class="material-symbols-outlined text-primary text-5xl font-light">visibility</span>
        </div>
        <h1 class="text-neutral-900 dark:text-white text-4xl font-light leading-tight tracking-tight text-center">
            Share your wish?
        </h1>
        <div class="w-12 h-[1px] bg-primary/40 my-8"></div>
        <p class="text-neutral-600 dark:text-white/60 text-lg font-normal leading-relaxed text-center max-w-xs">
            Choose whether others can see your wish on the Wall of Tomorrow
        </p>
    </div>
    
    <!-- Bottom Choices -->
    <div class="z-10 w-full px-6 pb-10 md:pb-12 max-w-md mx-auto">
        <div class="flex flex-col gap-4">
            <!-- Anonymous Option -->
            <button onclick="chooseVisibility(true)" class="relative group w-full flex flex-col h-auto bg-primary text-background-dark text-lg font-bold tracking-wide rounded-xl shadow-[0_0_20px_rgba(236,182,19,0.2)] hover:shadow-[0_0_30px_rgba(236,182,19,0.4)] transition-all duration-300 transform active:scale-[0.98] p-4">
                <span class="absolute inset-0 w-full h-full bg-white/20 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity"></span>
                <div class="relative z-10 flex items-center justify-between">
                    <div class="text-left">
                        <div class="font-bold">Yes, Share It</div>
                        <div class="text-sm font-normal opacity-80">Your wish appears on the wall</div>
                    </div>
                    <span class="material-symbols-outlined text-2xl">share</span>
                </div>
            </button>
            
            <!-- Private Option -->
            <button onclick="chooseVisibility(false)" class="relative group w-full flex flex-col h-auto bg-transparent border border-primary text-primary text-lg font-bold tracking-wide rounded-xl hover:bg-primary/10 transition-all duration-300 p-4">
                <div class="flex items-center justify-between">
                    <div class="text-left">
                        <div class="font-bold">Keep It Private</div>
                        <div class="text-sm font-normal opacity-60">Your wish stays with you</div>
                    </div>
                    <span class="material-symbols-outlined text-2xl">lock</span>
                </div>
            </button>
        </div>
        
        <p class="mt-6 text-xs text-center text-neutral-400 dark:text-white/20">
            Both choices are saved to your collection
        </p>
    </div>
</div>

<script src="../../src/js/api.js"></script>
<script src="../../src/js/app.js"></script>
<script src="../../src/js/fireworks.js"></script>
<script src="../../src/js/audio-controller.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        fireworks.init({ autoRain: true });
    });

    async function chooseVisibility(isPublic) {
        const currentWish = JSON.parse(sessionStorage.getItem('currentWish'));
        if (!currentWish || !currentWish.id) {
            console.error('No current wish found in session');
            goHome();
            return;
        }

        try {
            const response = await wishAPI.updateWish(currentWish.id, currentWish.text, isPublic);
            if (response.success) {
                currentWish.isPublic = isPublic;
                sessionStorage.setItem('currentWish', JSON.stringify(currentWish));
                goTo('confirmation');
            } else {
                throw new Error(response.message || 'Failed to update wish visibility');
            }
        } catch (error) {
            console.error('Error updating visibility:', error);
            alert('There was an error saving your choice. Please try again.');
        }
    }
</script>
</body>
</html>
